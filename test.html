<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>Koziar Plany - Premium Workout</title>

<link rel="icon" type="image/png" href="logo.png">
<link rel="apple-touch-icon" href="logo.png">
<meta name="theme-color" content="#0a0a0a">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest"></script>

<style>
:root {
    --bg: #0a0a0a;
    --card: #141414;
    --border: #262626;
    --text: #ffffff;
    --text-dim: #a0a0a0;
    --gold: #d4af37;
    --gold-glow: rgba(212, 175, 55, 0.15);
    --pro: #3b82f6;
    --pro-glow: rgba(59, 130, 246, 0.15);
    --danger: #ef4444;
    --nav-bg: rgba(10, 10, 10, 0.9);
}

* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
    margin: 0;
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--text);
    padding-bottom: 160px; /* Wiƒôkszy odstƒôp na dole */
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
}

/* --- NAG≈Å√ìWEK --- */
header {
    position: sticky; top: 0; z-index: 100;
    background: var(--nav-bg);
    backdrop-filter: blur(15px);
    padding: 12px 16px;
    border-bottom: 1px solid var(--border);
}

#planSelect {
    width: 100%; background: #1a1a1a; color: var(--gold);
    border: 1px solid var(--border); padding: 12px;
    border-radius: 12px; font-weight: 700; font-size: 14px; outline: none;
    appearance: none; text-align: center;
}

/* --- MAIN --- */
main { padding: 16px; max-width: 800px; margin: 0 auto; }

.notes-area {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 16px; margin-bottom: 20px; padding: 14px;
}
.notes-area label { display: block; color: var(--gold); font-size: 10px; font-weight: 800; text-transform: uppercase; margin-bottom: 6px; letter-spacing: 1px; }
.notes-area textarea { width: 100%; background: transparent; border: none; color: var(--text-dim); font-size: 13px; line-height: 1.5; resize: none; outline: none; }

/* --- DZIE≈É TRENINGOWY --- */
.day { 
    background: var(--card); margin-bottom: 24px; border-radius: 20px; 
    border: 1px solid var(--border); overflow: hidden; 
    transition: transform 0.2s, opacity 0.3s;
}
.day.inactive { opacity: 0.4; filter: grayscale(0.8); }
.day.active-today { border-color: var(--gold); box-shadow: 0 0 20px var(--gold-glow); }

.day-header {
    background: rgba(255,255,255,0.02); padding: 14px 16px;
    display: flex; justify-content: space-between; align-items: center;
    border-bottom: 1px solid var(--border);
}
.day-title-input { background: transparent; border: none; color: var(--gold); font-size: 16px; font-weight: 800; text-transform: uppercase; outline: none; width: 60%; }

/* --- TRENING (GRID ZAMIAST TABLE) --- */
.exercise-row {
    display: grid;
    grid-template-columns: 45px 1fr 45px 45px 55px; /* Standart: Check | Name | S | P | KG */
    align-items: center;
    padding: 10px 8px;
    border-bottom: 1px solid rgba(255,255,255,0.03);
}

/* Tryb PRO - Dodajemy kolumny */
.pro-mode .exercise-row {
    grid-template-columns: 45px 1fr 35px 35px 50px 45px 40px 55px;
}

.exercise-row.header-row {
    background: transparent;
    font-size: 9px;
    color: var(--text-dim);
    font-weight: 700;
    text-transform: uppercase;
}

.exercise-row.done { background: rgba(212, 175, 55, 0.05); }
.exercise-row.done input { color: #555; text-decoration: line-through; }

.col-input {
    background: transparent; border: none; color: var(--text);
    font-size: 13px; padding: 8px 4px; width: 100%; text-align: center;
    outline: none;
}
.col-input.name { text-align: left; font-weight: 600; padding-left: 8px; overflow: hidden; text-overflow: ellipsis; }

/* Akcje edycji */
.edit-actions { display: flex; gap: 8px; padding: 10px; justify-content: center; background: rgba(0,0,0,0.2); }

/* --- FLOATING LOGO --- */
.floating-footer { position: fixed; bottom: 90px; right: 16px; z-index: 99; }
.floating-logo {
    width: 50px; height: 50px; border-radius: 50%;
    background: #111; border: 2px solid var(--gold);
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
}
.floating-logo img { width: 60%; height: 60%; }

/* --- NAV BAR --- */
.bottom-nav {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: var(--nav-bg); backdrop-filter: blur(20px);
    border-top: 1px solid var(--border);
    display: grid; grid-template-columns: repeat(6, 1fr);
    padding: 10px 4px calc(10px + env(safe-area-inset-bottom));
    z-index: 1000;
}

.nav-btn {
    background: none; border: none; color: #666; 
    display: flex; flex-direction: column; align-items: center; gap: 4px;
    font-size: 8px; font-weight: 700; text-transform: uppercase;
}
.nav-btn.active { color: var(--gold); }
.nav-btn.pro-btn.active-pro { color: var(--pro); filter: drop-shadow(0 0 8px var(--pro-glow)); }
.nav-btn i { width: 20px; height: 20px; }

/* MODALE */
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
.modal.active { display: flex; }
.modal-box { background: var(--card); width: 100%; max-width: 400px; padding: 25px; border-radius: 24px; border: 1px solid var(--border); }

/* Ukrywanie kolumn PRO w standardzie */
.col-pro-field { display: none; }
.pro-mode .col-pro-field { display: block; }

.btn-add-row { width: 100%; padding: 14px; background: transparent; color: var(--gold); border: none; font-weight: 700; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; }

/* Responsywno≈õƒá dla ma≈Çych ekran√≥w */
@media (max-width: 400px) {
    .pro-mode .exercise-row { font-size: 11px; }
    .col-input { font-size: 11px; }
}

</style>
</head>
<body id="bodyTag">

<header>
    <select id="planSelect" onchange="loadPlan()"></select>
</header>

<div class="floating-footer">
    <div class="floating-logo" onclick="handleLogoClick()">
        <img src="logo.png" alt="Logo">
    </div>
</div>

<main id="mainContainer">
    <div class="notes-area">
        <label>Notatki do planu</label>
        <textarea id="planNotes" oninput="autoHeight(this); saveNotes()" placeholder="Cele, progresja, suplementacja..."></textarea>
    </div>
    <div id="week"></div>
</main>

<div class="locked-footer" id="lockedFooter" style="display:none; padding: 20px; position: fixed; bottom: 80px; width: 100%; text-align: center;">
    <button class="activate-btn" onclick="activatePlan()" style="background: var(--gold); color: #000; border: none; padding: 15px 30px; border-radius: 12px; font-weight: 900; width: 90%;">
        ‚≠ê ODBLOKUJ TEN PLAN (EDYTUJ)
    </button>
</div>

<nav class="bottom-nav" id="bottomNav">
    <button class="nav-btn pro-btn edit-only" id="proBtn" onclick="togglePro()">
        <i data-lucide="zap"></i><span>PRO</span>
    </button>
    <button class="nav-btn" onclick="newPlan()">
        <i data-lucide="plus-circle"></i><span>NOWY</span>
    </button>
    <button class="nav-btn edit-only" onclick="resetWeek()">
        <i data-lucide="rotate-ccw"></i><span>RESET</span>
    </button>
    <button class="nav-btn edit-only" onclick="openExport()">
        <i data-lucide="share-2"></i><span>ZAPISZ</span>
    </button>
    <button class="nav-btn" onclick="openImport()">
        <i data-lucide="download"></i><span>IMPORT</span>
    </button>
    <button class="nav-btn edit-only" style="color:var(--danger)" onclick="deletePlan()">
        <i data-lucide="trash-2"></i><span>USU≈É</span>
    </button>
</nav>

<div class="modal" id="infoModal">
    <div class="modal-box">
        <h2 id="infoTitle" style="color:var(--gold); margin-top:0"></h2>
        <p id="infoContent" style="color:var(--text-dim); line-height:1.6; font-size:14px; white-space: pre-wrap;"></p>
        <button class="btn-add-row" onclick="closeModals()" style="background:var(--gold); color:#000; border-radius:8px; margin-top:10px">ZAMKNIJ</button>
    </div>
</div>

<div class="modal" id="importModal">
    <div class="modal-box">
        <h3>Importuj Plan</h3>
        <input type="file" id="importFile" accept=".tsv" onchange="handleFileSelect(event)" style="margin-bottom:15px; font-size:12px; color:#999">
        <textarea id="importText" style="width:100%; height:100px; background:#000; border:1px solid #333; color:#fff; border-radius:8px; padding:10px; font-size:10px" placeholder="Wklej kod TSV..."></textarea>
        <button class="btn-add-row" onclick="applyImport()">IMPORTUJ</button>
        <button class="btn-add-row" onclick="closeModals()" style="color:#666">ANULUJ</button>
    </div>
</div>

<div class="modal" id="exportModal">
    <div class="modal-box">
        <h3>Tw√≥j Plan (TSV)</h3>
        <textarea id="exportText" style="width:100%; height:150px; background:#000; border:1px solid #333; color:#0f0; font-family:monospace; font-size:10px; border-radius:8px; padding:10px" readonly></textarea>
        <button class="btn-add-row" onclick="downloadTSV()">POBIERZ PLIK .TSV</button>
        <button class="btn-add-row" onclick="closeModals()">GOTOWE</button>
    </div>
</div>

<script>
// --- LOGIKA BIZNESOWA (Twoja oryginalna, zoptymalizowana pod renderowanie Grid) ---
const REMOTE_FILES = {
    "3-dniowy FBW - by Koziar": "basic1.tsv",
    "4-dniowy Upper/Lower - by Koziar": "basic2.tsv",
    "5-dniowy U/L/PPL - by Koziar": "basic3.tsv"
};

let plans = JSON.parse(localStorage.getItem("plans")) || {};
let checks = JSON.parse(localStorage.getItem("checks")) || {};
let currentPlan = localStorage.getItem("currentPlanName") || "";
let editStates = {};

function save(){
    localStorage.setItem("plans", JSON.stringify(plans));
    localStorage.setItem("checks", JSON.stringify(checks));
    localStorage.setItem("currentPlanName", currentPlan);
}

function handleLogoClick() { window.scrollTo({ top: 0, behavior: 'smooth' }); }

function render() {
    const p = plans[currentPlan];
    const weekEl = document.getElementById("week");
    const lockedFooter = document.getElementById("lockedFooter");

    if(!p) {
        weekEl.innerHTML = "<div style='text-align:center;padding:100px 20px;color:#444;'>WYBIERZ PLAN LUB STW√ìRZ NOWY</div>";
        updateMenuVisibility(false);
        lockedFooter.style.display = "none";
        return;
    }

    const isLocked = p.isLocked;
    document.body.classList.toggle("locked-mode", isLocked);
    lockedFooter.style.display = isLocked ? "block" : "none";
    updateMenuVisibility(!isLocked);
    document.getElementById("proBtn").classList.toggle("active-pro", p.proMode);
    
    document.getElementById("planNotes").value = p.notes || "";
    document.getElementById("planNotes").readOnly = isLocked;

    weekEl.className = p.proMode ? "pro-mode" : "standard-mode";

    weekEl.innerHTML = p.days.map((day, di) => {
        const dayChecks = checks[currentPlan]?.[di] || {};
        const isEditing = editStates[di];
        const hasChecks = Object.values(dayChecks).some(v => v);

        return `
        <div class="day ${day.active?'':'inactive'} ${hasChecks && day.active ? 'active-today' : ''}">
            <div class="day-header">
                <input class="day-title-input" value="${day.name}" ${isEditing && !isLocked ? '' : 'readonly'} oninput="plans[currentPlan].days[${di}].name=this.value;save()">
                <div style="display:flex;gap:8px">
                    <button class="row-icon-btn" onclick="toggleDay(${di})" style="background:${day.active?'var(--gold)':'#222'}; border:none; border-radius:8px; padding:6px; color:${day.active?'#000':'#666'}">
                        <i data-lucide="${day.active?'pause':'play'}" style="width:16px; height:16px"></i>
                    </button>
                    ${!isLocked ? `
                        <button class="row-icon-btn" onclick="toggleEdit(${di})" style="background:${isEditing?'#fff':'#222'}; border:none; border-radius:8px; padding:6px; color:${isEditing?'#000':'#666'}">
                            <i data-lucide="edit-3" style="width:16px; height:16px"></i>
                        </button>
                    ` : ''}
                </div>
            </div>
            
            <div class="exercise-row header-row">
                <span>‚úî</span>
                <span>ƒÜwiczenie</span>
                <span>S</span>
                <span>P</span>
                <span>KG</span>
                <span class="col-pro-field">ODP</span>
                <span class="col-pro-field">RIR</span>
                <span class="col-pro-field">TMP</span>
            </div>

            ${day.rows.map((r, ri) => `
                <div class="exercise-row ${dayChecks[ri]?'done':''}">
                    <input type="checkbox" ${dayChecks[ri]?'checked':''} onchange="toggleCheck(${di},${ri},this.checked)" ${isLocked ? 'disabled' : ''} style="width:18px; height:18px; accent-color:var(--gold)">
                    
                    <input type="text" class="col-input name" value="${r[0]||''}" 
                        oninput="updRow(${di},${ri},0,this.value)" 
                        onclick="${!isEditing ? `showInfo('${r[0]}', '${(r[7]||"").replace(/'/g, "\\'")}')` : ''}"
                        style="${!isEditing && r[7] && r[7] !== '...' ? 'border-bottom: 1px dotted var(--gold);' : ''}"
                        ${isLocked ? 'readonly' : ''}>
                    
                    <input type="text" class="col-input" value="${r[1]||''}" oninput="updRow(${di},${ri},1,this.value)" ${isLocked ? 'readonly' : ''}>
                    <input type="text" class="col-input" value="${r[2]||''}" oninput="updRow(${di},${ri},2,this.value)" ${isLocked ? 'readonly' : ''}>
                    <input type="text" class="col-input" value="${r[3]||''}" oninput="updRow(${di},${ri},3,this.value)" ${isLocked ? 'readonly' : ''}>
                    
                    <input type="text" class="col-input col-pro-field" value="${r[4]||''}" oninput="updRow(${di},${ri},4,this.value)" ${isLocked ? 'readonly' : ''}>
                    <input type="text" class="col-input col-pro-field" value="${r[5]||''}" oninput="updRow(${di},${ri},5,this.value)" ${isLocked ? 'readonly' : ''}>
                    <input type="text" class="col-input col-pro-field" value="${r[6]||''}" oninput="updRow(${di},${ri},6,this.value)" ${isLocked ? 'readonly' : ''}>
                </div>
                ${isEditing ? `
                    <div class="edit-actions">
                        <button onclick="promptInfo(${di},${ri})" style="background:none; border:none; color:var(--gold); font-size:10px;"><i data-lucide="info" style="width:14px"></i> INFO</button>
                        <button onclick="delRow(${di},${ri})" style="background:none; border:none; color:var(--danger); font-size:10px;"><i data-lucide="trash-2" style="width:14px"></i> USU≈É</button>
                    </div>
                ` : ''}
            `).join('')}
            
            ${isEditing ? `<button class="btn-add-row" onclick="addRow(${di})">+ Dodaj ƒáwiczenie</button>` : ''}
        </div>`;
    }).join('');
    lucide.createIcons();
}

// Funkcje pomocnicze
function updateMenuVisibility(full) {
    document.querySelectorAll(".edit-only").forEach(el => { el.style.display = full ? "flex" : "none"; });
}

function togglePro(){ if(!plans[currentPlan].isLocked) { plans[currentPlan].proMode = !plans[currentPlan].proMode; save(); render(); } }
function toggleDay(di){ if(!plans[currentPlan].isLocked) { plans[currentPlan].days[di].active = !plans[currentPlan].days[di].active; save(); render(); } }
function toggleEdit(di){ if(!plans[currentPlan].isLocked) { editStates[di] = !editStates[di]; render(); } }
function updRow(di,ri,ci,v){ if(!plans[currentPlan].isLocked){ plans[currentPlan].days[di].rows[ri][ci]=v; save(); } }
function addRow(di){ plans[currentPlan].days[di].rows.push(["","","","","","","","..."]); save(); render(); }
function delRow(di,ri){ plans[currentPlan].days[di].rows.splice(ri,1); save(); render(); }

function activatePlan() {
    const p = plans[currentPlan];
    const newName = prompt("Nazwij swojƒÖ kopiƒô planu:", currentPlan.replace(" - by Koziar", ""));
    if(newName) {
        const copy = JSON.parse(JSON.stringify(p));
        copy.isLocked = false;
        plans[newName] = copy;
        currentPlan = newName;
        save(); initSelect(); render();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

function newPlan() {
    const n = prompt("Nazwa nowego planu:");
    if(n) {
        plans[n] = { 
            notes: "", 
            days: ["Poniedzia≈Çek","Wtorek","≈öroda","Czwartek","PiƒÖtek","Sobota","Niedziela"].map(d=>({name:d,active:true,rows:[]})), 
            isLocked: false, proMode: false 
        };
        currentPlan = n; save(); initSelect(); render();
    }
}

function deletePlan(){ if(confirm("UsunƒÖƒá ten plan?")) { delete plans[currentPlan]; currentPlan = Object.keys(plans)[0] || ""; save(); location.reload(); } }
function resetWeek(){ if(confirm("Reset postƒôp√≥w?")) { checks[currentPlan] = {}; save(); render(); } }

function toggleCheck(di,ri,v){
    if(!checks[currentPlan]) checks[currentPlan] = {};
    if(!checks[currentPlan][di]) checks[currentPlan][di] = {};
    checks[currentPlan][di][ri] = v; save(); render();
}

function promptInfo(di,ri){
    const n = prompt("Opis ƒáwiczenia:", plans[currentPlan].days[di].rows[ri][7]);
    if(n !== null){ plans[currentPlan].days[di].rows[ri][7] = n; save(); render(); }
}

function showInfo(title, content) {
    if(!content || content === "...") return;
    document.getElementById("infoTitle").innerText = title;
    document.getElementById("infoContent").innerText = content;
    document.getElementById("infoModal").classList.add("active");
}

function closeModals() { document.querySelectorAll(".modal").forEach(m => m.classList.remove("active")); }

// Export / Import
function openExport() {
    const p = plans[currentPlan];
    let out = [`!!NOTES!!\t${(p.notes||"").replace(/\n/g,"[BR]")}`];
    p.days.forEach(d => {
        out.push(`# ${d.name} | ${d.active?'AKTYWNY':'PRZERWA'}`);
        d.rows.forEach(r => out.push(r.join("\t")));
    });
    document.getElementById("exportText").value = out.join("\n");
    document.getElementById("exportModal").classList.add("active");
}

function downloadTSV() {
    const a = document.createElement("a");
    a.href = URL.createObjectURL(new Blob([document.getElementById("exportText").value], {type: "text/tab-separated-values"}));
    a.download = currentPlan + ".tsv"; a.click();
}

function openImport() { document.getElementById("importModal").classList.add("active"); }
function handleFileSelect(e) {
    const reader = new FileReader();
    reader.onload = (ev) => { document.getElementById("importText").value = ev.target.result; };
    reader.readAsText(e.target.files[0]);
}

function applyImport() {
    const txt = document.getElementById("importText").value.trim();
    if(!txt) return;
    const imported = parseTSV(txt);
    const name = prompt("Nazwa planu:", "Import " + new Date().toLocaleDateString());
    if(name) { plans[name] = imported; currentPlan = name; save(); location.reload(); }
}

function parseTSV(text) {
    const lines = text.trim().split("\n");
    let week = [], day = null, notes = "";
    lines.forEach(l => {
        if(l.startsWith("!!NOTES!!")) notes = l.split("\t")[1]?.replace(/\[BR\]/g,"\n") || "";
        else if(l.startsWith("#")) {
            const parts = l.replace("#","").split("|").map(x=>x.trim());
            day = { name: parts[0], active: parts[1] !== "PRZERWA", rows: [] };
            week.push(day);
        } else if(day && l.trim()) {
            let row = l.split("\t"); while(row.length < 8) row.push(""); day.rows.push(row);
        }
    });
    return { notes, days: week, proMode: false, isLocked: false };
}

function initSelect() {
    const ps = document.getElementById("planSelect"); ps.innerHTML = "";
    const gL = document.createElement("optgroup"); gL.label = "üìã KLASYKI KOZIARA";
    const gU = document.createElement("optgroup"); gU.label = "üí™ TWOJE PLANY";
    Object.keys(plans).sort().forEach(k => {
        const o = new Option(k, k);
        if(plans[k].isLocked) gL.appendChild(o); else gU.appendChild(o);
    });
    ps.add(gL); ps.add(gU); ps.value = currentPlan;
}

async function fetchRemotePlans() {
    for(const [name, file] of Object.entries(REMOTE_FILES)) {
        try {
            const r = await fetch(file);
            if(r.ok) {
                const text = await r.text();
                const parsed = parseTSV(text);
                parsed.isLocked = true; 
                plans[name] = parsed;
            }
        } catch(e) {}
    }
    if(!currentPlan || !plans[currentPlan]) currentPlan = Object.keys(plans)[0] || "";
    initSelect(); render();
}

function loadPlan(){ currentPlan=document.getElementById("planSelect").value; editStates={}; save(); render(); }
function autoHeight(el){ el.style.height="auto"; el.style.height=el.scrollHeight+"px"; }
function saveNotes(){ if(plans[currentPlan] && !plans[currentPlan].isLocked){ plans[currentPlan].notes=document.getElementById("planNotes").value; save(); }}

fetchRemotePlans();
</script>
</body>
</html>
