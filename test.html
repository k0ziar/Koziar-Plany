<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Koziar Plany</title>

<link rel="icon" type="image/png" href="logo.png">
<link rel="apple-touch-icon" href="logo.png">
<meta name="theme-color" content="#0a0a0a">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800;900&display=swap" rel="stylesheet">
<script src="https://unpkg.com/lucide@latest"></script>

<style>
:root{
    --bg:#0a0a0a;
    --card:#141414;
    --border:#222;
    --text:#efefef;
    --gold:#d4af37;
    --gold-glow:rgba(212,175,55,0.25);
    --danger:#ff4444;
    --pro:#3b82f6;
    --nav-bg: rgba(15, 15, 15, 0.96);
}

*{box-sizing:border-box;-webkit-tap-highlight-color:transparent;}

body{
    margin:0;
    font-family:'Inter', sans-serif;
    background:var(--bg);
    color:var(--text);
    padding-bottom: 120px;
    overflow-x:hidden;
    -webkit-font-smoothing: antialiased;
}

/* --- NAG≈Å√ìWEK --- */
header {
    position: sticky; top: 0; z-index: 100;
    background: var(--nav-bg);
    backdrop-filter: blur(20px);
    padding: 14px 16px; border-bottom: 1px solid var(--border);
}

#planSelect {
    width: 100%; background: #1a1a1a; color: var(--gold);
    border: 1px solid var(--border); padding: 14px;
    border-radius: 14px; font-weight: 800; font-size: 14px; outline: none;
    appearance: none; text-align: center;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.3);
}

/* --- LOGO --- */
.floating-footer {
    position: fixed; bottom: 100px; right: 16px;
    z-index: 99;
}
.floating-logo {
    width: 48px; height: 48px; cursor: pointer; transition: transform 0.2s;
    filter: drop-shadow(0 4px 10px rgba(0,0,0,0.8));
}
.floating-logo:active { transform: scale(0.9); }
.floating-logo img { width: 100%; height: 100%; object-fit: contain; }

/* --- DOLNY NAV BAR --- */
.bottom-nav {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: var(--nav-bg);
    backdrop-filter: blur(20px);
    border-top: 1px solid var(--border);
    display: flex; justify-content: space-evenly;
    padding: 12px 6px env(safe-area-inset-bottom);
    z-index: 1000;
}

.nav-btn {
    display: flex; flex-direction: column; align-items: center;
    background: none; border: none; color: #555; gap: 5px;
    flex: 1; min-width: 50px;
    font-size: 10px; font-weight: 600; cursor: pointer; transition: 0.2s;
}
.nav-btn.active { color: var(--gold); }
.nav-btn i { width: 22px; height: 22px; stroke-width: 2.2px; }
.nav-btn.pro-btn.active-pro { color: var(--pro); }

/* --- MAIN CONTENT --- */
main { padding: 16px; max-width: 650px; margin: 0 auto; }

.notes-area {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 16px; margin-bottom: 24px; padding: 14px;
}
.notes-area label { display: block; color: var(--gold); font-size: 10px; font-weight: 900; text-transform: uppercase; margin-bottom: 8px; opacity: 0.7; letter-spacing: 0.8px; }
.notes-area textarea { width: 100%; background: transparent; border: none; color: #ccc; font-size: 14px; line-height: 1.5; resize: none; outline: none; min-height: 40px; }

.day { background: var(--card); margin-bottom: 24px; border-radius: 20px; border: 1px solid var(--border); overflow: hidden; }
.day.inactive { opacity: 0.3; filter: grayscale(1); transition: 0.3s; }
.day.active-today { border-color: rgba(212, 175, 55, 0.4); box-shadow: 0 8px 30px var(--gold-glow); }

.day-header {
    background: rgba(255, 255, 255, 0.02); padding: 14px 18px;
    display: flex; justify-content: space-between; align-items: center;
}
.day-title-input { background: transparent; border: none; color: var(--gold); font-size: 16px; font-weight: 900; text-transform: uppercase; outline: none; letter-spacing: 0.5px; }

/* --- TABELA MOBILNA --- */
.table-wrapper { 
    width: 100%; overflow-x: auto; 
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none; /* Firefox */
}
.table-wrapper::-webkit-scrollbar { display: none; } /* Chrome/Safari */

table { width: 800px; border-collapse: collapse; table-layout: fixed; }
.standard-mode table { width: 100%; } /* Na mobile bez pro mode nie chcemy scrolla je≈õli siƒô da */

th { font-size: 9px; color: #444; padding: 12px 2px; text-transform: uppercase; border-bottom: 1px solid var(--border); }
td { padding: 4px 0; border-bottom: 1px solid rgba(255,255,255,0.01); }

input[type="text"] { 
    width: 100%; background: transparent; border: none; color: var(--text); 
    padding: 12px 2px; font-size: 14px; text-align: center; outline: none; 
}

.col-check { width: 46px; }
.col-name { width: auto; text-align: left; padding-left: 12px; }
.col-val { width: 48px; }
.col-pro { width: 65px; display: none; background: rgba(59, 130, 246, 0.01); }

.pro-mode .col-pro { display: table-cell; }
.pro-mode table { width: 850px; }

tr.done { background: rgba(212, 175, 55, 0.03); }
tr.done input { color: #555; text-decoration: line-through; }
input[type="checkbox"] { width: 22px; height: 22px; accent-color: var(--gold); cursor: pointer; }

.btn-add-row { width: 100%; padding: 18px; background: transparent; color: var(--gold); border: none; border-top: 1px solid var(--border); font-weight: 800; font-size: 12px; letter-spacing: 1px; cursor: pointer; }

/* --- TRYB PODGLƒÑDU --- */
.locked-mode .day { opacity: 0.6; pointer-events: none; }
.locked-mode .day-header { filter: brightness(0.7); }

.locked-footer {
    display: none;
    position: fixed; bottom: 85px; left: 0; right: 0;
    padding: 15px; z-index: 998;
    background: linear-gradient(0deg, var(--bg) 60%, transparent);
}
.locked-mode .locked-footer { display: block; }

.activate-btn {
    background: linear-gradient(135deg, #d4af37, #b8962d);
    color: #000; padding: 16px; border-radius: 16px;
    font-weight: 900; font-size: 14px; text-transform: uppercase;
    box-shadow: 0 10px 25px rgba(212, 175, 55, 0.3);
    cursor: pointer; border: none; width: 100%;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.02); }
    100% { transform: scale(1); }
}

/* --- MODALE --- */
.modal { position: fixed; inset: 0; background: rgba(0,0,0,0.98); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
.modal.active { display: flex; }
.modal-box { background: var(--card); width: 100%; max-width: 400px; padding: 30px; border-radius: 28px; border: 1px solid var(--border); text-align: center; }

.row-icon-btn {
    background: #1a1a1a; border: 1px solid #2a2a2a; color: #fff;
    width: 36px; height: 36px; border-radius: 10px;
    display: flex; align-items: center; justify-content: center; cursor: pointer;
}
.row-icon-btn.active { background: var(--gold); color: #000; border: none; }

</style>
</head>
<body id="bodyTag">

<header>
    <select id="planSelect" onchange="loadPlan()"></select>
</header>

<div class="floating-footer">
    <div class="floating-logo" onclick="handleLogoClick()">
        <img src="logo.png" alt="Logo">
    </div>
</div>

<main id="mainContainer">
    <div class="notes-area">
        <label>Twoje Notatki</label>
        <textarea id="planNotes" oninput="autoHeight(this); saveNotes()" placeholder="Brak notatek..."></textarea>
    </div>
    <div id="week"></div>
</main>

<div class="locked-footer" id="lockedFooter">
    <button class="activate-btn" onclick="activatePlan()">
        üî• AKTYWUJ TEN PLAN I EDYTUJ
    </button>
</div>

<nav class="bottom-nav" id="bottomNav">
    <button class="nav-btn pro-btn edit-only" id="proBtn" onclick="togglePro()">
        <i data-lucide="zap"></i><span>PRO</span>
    </button>
    
    <button class="nav-btn" onclick="newPlan()">
        <i data-lucide="plus-circle"></i><span>NOWY</span>
    </button>
    
    <button class="nav-btn edit-only" onclick="resetWeek()">
        <i data-lucide="rotate-ccw"></i><span>RESET</span>
    </button>
    
    <button class="nav-btn edit-only" onclick="openExport()">
        <i data-lucide="share-2"></i><span>ZAPISZ</span>
    </button>
    
    <button class="nav-btn" onclick="openImport()">
        <i data-lucide="download"></i><span>IMPORT</span>
    </button>
    
    <button class="nav-btn edit-only" style="color:var(--danger)" onclick="deletePlan()">
        <i data-lucide="trash-2"></i><span>USU≈É</span>
    </button>
</nav>

<div class="modal" id="infoModal">
    <div class="modal-box">
        <h2 id="infoTitle" style="color:var(--gold); margin:0 0 15px 0; font-size:20px"></h2>
        <div id="infoContent" style="font-size:15px; line-height:1.6; color:#ccc; text-align: left; background: #000; padding: 20px; border-radius: 16px; border: 1px solid #222; white-space: pre-wrap;"></div>
        <button class="btn-add-row" onclick="closeModals()" style="margin-top:20px; border:1px solid var(--border); border-radius:14px">ZAMKNIJ</button>
    </div>
</div>

<div class="modal" id="importModal">
    <div class="modal-box">
        <h3 style="margin-top:0">Importuj Plan</h3>
        <p style="font-size:12px; color:#666">Wybierz plik .tsv lub wklej tre≈õƒá</p>
        <input type="file" id="importFile" accept=".tsv" onchange="handleFileSelect(event)" style="margin: 15px 0; font-size:12px; width:100%">
        <textarea id="importText" style="height:120px;width:100%;background:#000;color:#fff;padding:12px;border:1px solid #333;border-radius:14px; font-size:11px" placeholder="Wklej TSV tutaj..."></textarea>
        <button class="btn-add-row" onclick="applyImport()" style="color:var(--gold); font-size:14px">IMPORTUJ</button>
        <button class="btn-add-row" onclick="closeModals()">ANULUJ</button>
    </div>
</div>

<div class="modal" id="exportModal">
    <div class="modal-box">
        <h3>Tw√≥j Plan (TSV)</h3>
        <textarea id="exportText" style="height:150px;width:100%;background:#000;color:#0f0;font-family:monospace;font-size:10px;padding:12px;border:1px solid #333;border-radius:14px" readonly></textarea>
        <button class="btn-add-row" onclick="downloadTSV()" style="color:var(--gold)">POBIERZ PLIK</button>
        <button class="btn-add-row" onclick="closeModals()">GOTOWE</button>
    </div>
</div>

<script>
const REMOTE_FILES = {
    "3-dniowy FBW - by Koziar": "basic1.tsv",
    "4-dniowy Upper/Lower - by Koziar": "basic2.tsv",
    "5-dniowy U/L/PPL - by Koziar": "basic3.tsv"
};

let plans = JSON.parse(localStorage.getItem("plans")) || {};
let checks = JSON.parse(localStorage.getItem("checks")) || {};
let currentPlan = localStorage.getItem("currentPlanName") || "";
let editStates = {};

function save(){
    localStorage.setItem("plans", JSON.stringify(plans));
    localStorage.setItem("checks", JSON.stringify(checks));
    localStorage.setItem("currentPlanName", currentPlan);
}

function handleLogoClick() { window.scrollTo({ top: 0, behavior: 'smooth' }); }

function render() {
    const p = plans[currentPlan];
    if(!p) {
        document.getElementById("week").innerHTML = "<div style='text-align:center;padding:100px 20px;color:#444;font-weight:600'>Wybierz plan treningowy z g√≥ry lub stw√≥rz w≈Çasny przyciskiem NOWY</div>";
        document.body.className = "";
        updateMenuVisibility(false);
        return;
    }

    const isLocked = p.isLocked;
    document.body.className = isLocked ? "locked-mode" : "";
    updateMenuVisibility(!isLocked);

    document.getElementById("proBtn").classList.toggle("active-pro", p.proMode);
    
    const notesEl = document.getElementById("planNotes");
    notesEl.value = p.notes || "";
    notesEl.readOnly = isLocked;
    autoHeight(notesEl);

    const weekEl = document.getElementById("week");
    weekEl.className = p.proMode ? "pro-mode" : "standard-mode";

    weekEl.innerHTML = p.days.map((day, di) => {
        const dayChecks = checks[currentPlan]?.[di] || {};
        const isEditing = editStates[di];
        const hasChecks = Object.values(dayChecks).some(v => v);

        return `
        <div class="day ${day.active?'':'inactive'} ${hasChecks && day.active ? 'active-today' : ''}">
            <div class="day-header">
                <input class="day-title-input" value="${day.name}" ${isEditing && !isLocked ? '' : 'readonly'} oninput="plans[currentPlan].days[${di}].name=this.value;save()">
                <div style="display:flex;gap:10px">
                    <button class="row-icon-btn ${day.active?'active':''}" onclick="toggleDay(${di})">
                        <i data-lucide="${day.active?'pause':'play'}" style="width:16px"></i>
                    </button>
                    ${!isLocked ? `
                        <button class="row-icon-btn ${isEditing?'active':''}" onclick="toggleEdit(${di})">
                            <i data-lucide="edit-3" style="width:16px"></i>
                        </button>
                    ` : ''}
                </div>
            </div>
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th class="col-check">‚úî</th>
                            <th class="col-name">ƒÜwiczenie</th>
                            <th class="col-val">S</th>
                            <th class="col-val">P</th>
                            <th class="col-val">KG</th>
                            <th class="col-pro">ODP</th>
                            <th class="col-pro">RIR</th>
                            <th class="col-pro">TEMPO</th>
                            ${isEditing ? '<th style="width:50px"></th>' : ''}
                        </tr>
                    </thead>
                    <tbody>
                        ${day.rows.map((r, ri) => `
                            <tr class="${dayChecks[ri]?'done':''}">
                                <td class="col-check"><input type="checkbox" ${dayChecks[ri]?'checked':''} onchange="toggleCheck(${di},${ri},this.checked)" ${isLocked ? 'disabled' : ''}></td>
                                <td class="col-name">
                                    <input type="text" value="${r[0]||''}" oninput="updRow(${di},${ri},0,this.value)" placeholder="..." 
                                    onclick="${!isEditing ? `showInfo('${r[0]}', '${(r[7]||"").replace(/'/g, "\\'")}')` : ''}"
                                    style="${!isEditing && r[7] && r[7] !== '...' ? 'text-decoration: underline dotted var(--gold); cursor:pointer;' : ''}" 
                                    ${isLocked ? 'readonly' : ''}>
                                </td>
                                <td class="col-val"><input type="text" value="${r[1]||''}" oninput="updRow(${di},${ri},1,this.value)" ${isLocked ? 'readonly' : ''}></td>
                                <td class="col-val"><input type="text" value="${r[2]||''}" oninput="updRow(${di},${ri},2,this.value)" ${isLocked ? 'readonly' : ''}></td>
                                <td class="col-val"><input type="text" value="${r[3]||''}" oninput="updRow(${di},${ri},3,this.value)" ${isLocked ? 'readonly' : ''}></td>
                                <td class="col-pro"><input type="text" value="${r[4]||''}" oninput="updRow(${di},${ri},4,this.value)" ${isLocked ? 'readonly' : ''}></td>
                                <td class="col-pro"><input type="text" value="${r[5]||''}" oninput="updRow(${di},${ri},5,this.value)" ${isLocked ? 'readonly' : ''}></td>
                                <td class="col-pro"><input type="text" value="${r[6]||''}" oninput="updRow(${di},${ri},6,this.value)" ${isLocked ? 'readonly' : ''}></td>
                                ${isEditing ? `
                                    <td style="display:flex; gap:8px; align-items:center; justify-content:center; padding-top:8px">
                                        <button onclick="promptInfo(${di},${ri})" style="background:none; border:none; color:var(--gold)"><i data-lucide="info" style="width:18px"></i></button>
                                        <button onclick="delRow(${di},${ri})" style="color:var(--danger);background:none;border:none"><i data-lucide="x" style="width:18px"></i></button>
                                    </td>` : ''}
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            </div>
            ${isEditing ? `<button class="btn-add-row" onclick="addRow(${di})">+ DODAJ ƒÜWICZENIE</button>` : ''}
        </div>`;
    }).join('');
    lucide.createIcons();
}

function updateMenuVisibility(full) {
    document.querySelectorAll(".edit-only").forEach(el => {
        el.style.display = full ? "flex" : "none";
    });
}

function activatePlan() {
    const p = plans[currentPlan];
    if(!p) return;
    const newName = prompt("Podaj nazwƒô dla Twojej kopii:", currentPlan.replace(" - by Koziar", ""));
    if(newName) {
        const copy = JSON.parse(JSON.stringify(p));
        copy.isLocked = false;
        plans[newName] = copy;
        currentPlan = newName;
        save(); initSelect(); render();
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }
}

function newPlan() {
    const n = prompt("Podaj nazwƒô planu:");
    if(n) {
        plans[n] = { 
            notes: "", 
            days: ["Poniedzia≈Çek","Wtorek","≈öroda","Czwartek","PiƒÖtek","Sobota","Niedziela"].map(d=>({name:d,active:true,rows:[]})), 
            isLocked: false, proMode: false 
        };
        currentPlan = n; save(); initSelect(); render();
    }
}

function togglePro(){ if(!plans[currentPlan].isLocked) { plans[currentPlan].proMode = !plans[currentPlan].proMode; save(); render(); } }
function deletePlan(){ if(!plans[currentPlan].isLocked && confirm("UsunƒÖƒá ten plan?")) { delete plans[currentPlan]; currentPlan = Object.keys(plans)[0] || ""; save(); location.reload(); } }
function resetWeek(){ if(confirm("Zresetowaƒá postƒôpy?")) { checks[currentPlan] = {}; save(); render(); } }

function updRow(di,ri,ci,v){ if(!plans[currentPlan].isLocked){ plans[currentPlan].days[di].rows[ri][ci]=v; save(); } }
function addRow(di){ plans[currentPlan].days[di].rows.push(["","","","","","","","..."]); save(); render(); }
function delRow(di,ri){ plans[currentPlan].days[di].rows.splice(ri,1); save(); render(); }
function promptInfo(di,ri){
    const n = prompt("Instrukcja:", plans[currentPlan].days[di].rows[ri][7]);
    if(n !== null){ plans[currentPlan].days[di].rows[ri][7] = n; save(); render(); }
}
function toggleCheck(di,ri,v){
    if(!checks[currentPlan]) checks[currentPlan] = {};
    if(!checks[currentPlan][di]) checks[currentPlan][di] = {};
    checks[currentPlan][di][ri] = v; save(); render();
}
function toggleDay(di){ if(!plans[currentPlan].isLocked) { plans[currentPlan].days[di].active = !plans[currentPlan].days[di].active; save(); render(); } }
function toggleEdit(di){ if(!plans[currentPlan].isLocked) { editStates[di] = !editStates[di]; render(); } }
function autoHeight(el){ el.style.height="auto"; el.style.height=el.scrollHeight+"px"; }
function saveNotes(){ if(plans[currentPlan] && !plans[currentPlan].isLocked){ plans[currentPlan].notes=document.getElementById("planNotes").value; save(); }}

function initSelect() {
    const ps = document.getElementById("planSelect"); ps.innerHTML = "";
    const gL = document.createElement("optgroup"); gL.label = "üìã GOTOWE PLANY (KOZIAR)";
    const gU = document.createElement("optgroup"); gU.label = "üí™ TWOJE PLANY TRENINGOWE";
    Object.keys(plans).sort().forEach(k => {
        const o = new Option(k, k);
        if(plans[k].isLocked) gL.appendChild(o); else gU.appendChild(o);
    });
    ps.add(gL); ps.add(gU); ps.value = currentPlan;
}

function showInfo(title, content) {
    if(!content || content === "...") return;
    document.getElementById("infoTitle").innerText = title;
    document.getElementById("infoContent").innerText = content;
    document.getElementById("infoModal").classList.add("active");
}

function openExport() {
    const p = plans[currentPlan]; if(!p) return;
    let out = [`!!NOTES!!\t${(p.notes||"").replace(/\n/g,"[BR]")}`];
    p.days.forEach(d => {
        out.push(`# ${d.name} | ${d.active?'AKTYWNY':'PRZERWA'}`);
        d.rows.forEach(r => out.push(r.join("\t")));
    });
    document.getElementById("exportText").value = out.join("\n");
    document.getElementById("exportModal").classList.add("active");
}

function downloadTSV() {
    const a = document.createElement("a");
    a.href = URL.createObjectURL(new Blob([document.getElementById("exportText").value], {type: "text/tab-separated-values"}));
    a.download = currentPlan + ".tsv"; a.click();
}

function openImport() { document.getElementById("importModal").classList.add("active"); }
function closeModals() { document.querySelectorAll(".modal").forEach(m => m.classList.remove("active")); }

function handleFileSelect(e) {
    const reader = new FileReader();
    reader.onload = (ev) => { document.getElementById("importText").value = ev.target.result; };
    reader.readAsText(e.target.files[0]);
}

function applyImport() {
    const txt = document.getElementById("importText").value.trim();
    if(!txt) return;
    const imported = parseTSV(txt);
    const name = prompt("Nazwa dla planu:", "Importowany " + new Date().toLocaleDateString());
    if(name) { plans[name] = imported; currentPlan = name; save(); location.reload(); }
}

function parseTSV(text) {
    const lines = text.trim().split("\n");
    let week = [], day = null, notes = "";
    lines.forEach(l => {
        if(l.startsWith("!!NOTES!!")) notes = l.split("\t")[1]?.replace(/\[BR\]/g,"\n") || "";
        else if(l.startsWith("#")) {
            const parts = l.replace("#","").split("|").map(x=>x.trim());
            day = { name: parts[0], active: parts[1] !== "PRZERWA" && parts[1] !== "OFF", rows: [] };
            week.push(day);
        } else if(day && l.trim()) {
            let row = l.split("\t"); while(row.length < 8) row.push(""); day.rows.push(row);
        }
    });
    return { notes, days: week, proMode: false, isLocked: false };
}

async function fetchRemotePlans() {
    for(const [name, file] of Object.entries(REMOTE_FILES)) {
        try {
            const r = await fetch(file);
            if(r.ok) {
                const text = await r.text();
                const parsed = parseTSV(text);
                parsed.isLocked = true; 
                plans[name] = parsed;
            }
        } catch(e) {}
    }
    if(!currentPlan || !plans[currentPlan]) currentPlan = Object.keys(plans)[0] || "";
    initSelect(); render();
}

fetchRemotePlans();
function loadPlan(){ currentPlan=document.getElementById("planSelect").value; editStates={}; save(); render(); }
</script>
</body>
</html>
